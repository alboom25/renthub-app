


<% if(!load_chunk){%> 
    <%- include('../shared/page-header') %>
    <%- include('../shared/top-page') %>
    <div class="page-content">
  <%}%>
      <div class="container-fluid">
          <%- include('../shared/page-title') %>
  
  
          <!--begin::Entry-->
  <div class="d-flex flex-column-fluid">
    <!--begin::Container-->
    <div class="container">
       <%- include('../shared/property-common') %>
       <div class="row">
        <div class="col-12">
          <div class="panel panel-default">           
            <div class="panel-body">
              <div class='row'>
                <div class='col-lg-7'>
                  <h4 class="card-title">Work Orders</h4>
                  <p class="card-title-desc"> All work orders created or submitted for this property.</p>
                </div>
                <div class='col-lg-5 text-right' style="margin:auto;">                                                                 								  
                    <button data-toggle="modal" data-target="#mdl_new_work_order" class="btn btn-info small-block px-4 mt-0 mb-3 mr-2"  >+ Add New Work Order</a>
                 </div>
              </div>
              <div class="row">
                <div class='col-12'>          
                  <hr>
                  <table id='tbl_work_orders' class="table table-nowrap border dt-responsive table-hover" style="width:100%">
                   <thead>
                      <tr>
                        <th>Description</th>
                        <th>Target</th>                                                                
                        <th>Added On</th> 
                        <th>Origin</th> 
                        <th>Type</th>                                      
                        <th>Priority</th> 
                        <th>Assigned To</th>                                   
                        <th>Status</th>
                        <th>Actions</th>  
                      </tr>
                   </thead>
                  </table>
                  </div>
              </div>
            </div>
          </div>
        </div>
        </div>
    </div>
    <!--end::Container-->
  </div>

                                  </div>
                                  <!-- container-fluid -->
  <% if(!load_chunk){%> </div> <%- include('../shared/page-footer') %> <%- include('../shared/admin-scripts') %> <%}%>
  
  <div id="mdl_new_work_order" class="modal fade" role="dialog">
    <div class="modal-dialog">
       <!-- Modal content-->
       <div class="modal-content">
          <div class="modal-header">
             <h5 class="modal-title">New Work Order</h5>
             <button type="button" class="close" data-dismiss="modal" aria-label="Close">
             <i class='bx bx-x'></i>
             </button>
          </div>
          <form id="frm_new_work_order" method="post" action ="#">
             <div class="modal-body">
                <div class="row">                                  
                    <div class="form-group col-md-12 col-lg-6">
                        <label for="unit_code">Unit/Room/House <span class="text-danger">*</span></label>
                        <select name='unit_code' id='unit_code' class="form-control selectpicker-select" data-size="5" data-live-search="true" tabindex="0"> </select>  
                     </div>

                     <div class="form-group col-md-12 col-lg-6">
                        <label for="work_type">Work Type <span class="text-danger">*</span></label>
                        <select name='work_type' id='work_type' class="form-control custom-select" tabindex="0"> 
                            <option value="Repair">Repair</option>
                            <option value="Maintenance">Maintenance</option>
                            <option value="Other">Other</option>
                        </select>  
                     </div>   
                     <div class="form-group col-md-12 col-lg-6">
                        <label for="priority">Priority</label>
                        <select name='priority' id='priority' class="form-control custom-select" tabindex="0"> 
                            <option value="Normal">Normal</option>
                            <option value="Low">Low</option>
                            <option value="High">High</option>
                        </select>  
                     </div> 
                     <div class="form-group col-md-12 col-lg-6">
                        <label for="supplier_code">Assigned Supplier </label>
                        <select name='supplier_code' id='supplier_code' class="form-control selectpicker-select" data-size="5" data-live-search="true" tabindex="0"> </select>  
                     </div>                           
                </div>
                <div class="row">   
                    <div class="form-group col-12">
                        <label for="description">Work Description <span class="text-danger">*</span></label>
                        <textarea class="form-control" id="description" name="description" rows="5" required></textarea>
                     </div>                  
                </div> 
               

             </div>
             <div class="modal-footer">     
                <button id="btn_save_work_order" type="submit" class="btn btn-success">Save Work Order</button>      
                <button type="button" class="btn btn-danger" data-dismiss="modal">Cancel</button>
             </div>
          </form>
       </div>
    </div>
 </div>	

 <div id="mdl_edit_work_order" class="modal fade" role="dialog">
    <div class="modal-dialog">
       <!-- Modal content-->
       <div class="modal-content">
          <div class="modal-header">
             <h5 class="modal-title">Edit Work Order</h5>
             <button type="button" class="close" data-dismiss="modal" aria-label="Close">
             <i class='bx bx-x'></i>
             </button>
          </div>
          <form id="frm_edit_work_order" method="post" action ="#">
              <input type="hidden" name="id"/>
            <div class="modal-body">
               <div class="row">                                
                   <div class="form-group col-md-12 col-lg-6">
                       <label for="edit_unit_code">Unit/Room/House <span class="text-danger">*</span></label>
                       <select name='unit_code' id='edit_unit_code' class="form-control selectpicker-select" data-size="5" data-live-search="true" tabindex="0"> </select>  
                    </div>

                    <div class="form-group col-md-12 col-lg-6">
                       <label for="edit_work_type">Work Type <span class="text-danger">*</span></label>
                       <select name='work_type' id='edit_work_type' class="form-control custom-select" tabindex="0"> 
                           <option value="Repair">Repair</option>
                           <option value="Maintenance">Maintenance</option>
                           <option value="Other">Other</option>
                       </select>  
                    </div>   
                    <div class="form-group col-md-12 col-lg-6">
                        <label for="edit_priority">Priority</label>
                        <select name='priority' id='edit_priority' class="form-control custom-select" tabindex="0"> 
                            <option value="Normal">Normal</option>
                            <option value="Low">Low</option>
                            <option value="High">High</option>
                        </select>  
                     </div> 
                     <div class="form-group col-md-12 col-lg-6">
                        <label for="edit_supplier_code">Assigned Supplier </label>
                        <select name='supplier_code' id='edit_supplier_code' class="form-control selectpicker-select" data-size="5" data-live-search="true" tabindex="0"> </select>  
                     </div>                           
               </div>
               <div class="row">   
                   <div class="form-group col-12">
                       <label for="edit_description">Work Description <span class="text-danger">*</span></label>
                       <textarea class="form-control" id="edit_description" name="description" rows="5" required></textarea>
                    </div>                  
               </div> 
            </div>
            <div class="modal-footer">     
               <button id="btn_edit_work_order" type="submit" class="btn btn-success">Update Work Order</button>      
               <button type="button" class="btn btn-danger" data-dismiss="modal">Cancel</button>
            </div>
         </form>
       </div>
    </div>
 </div>	

 
 <div id="mdl_add_work_progress" class="modal fade" role="dialog">
    <div class="modal-dialog">
       <!-- Modal content-->
       <div class="modal-content">
          <div class="modal-header">
             <h5 class="modal-title">Update Progress</h5>
             <button type="button" class="close" data-dismiss="modal" aria-label="Close">
             <i class='bx bx-x'></i>
             </button>
          </div>
          <form id="frm_work_order_progress" method="post" action ="#">
              <input type="hidden" name="work_id" id="progress_work_id"/>
            <div class="modal-body">
               <div class="row">                                
                   <div class="form-group col-12">
                       <label for="activity_date">Date <span class="text-danger">*</span></label>
                       <input id='activity_date' type="datetime-local" name="activity_date" class="form-control" required/>
                    </div>                                           
               </div>
               <div class="row">   
                   <div class="form-group col-12">
                       <label for="progress_description">Progress Description <span class="text-danger">*</span></label>
                       <textarea class="form-control" id="progress_description" name="description" rows="5" required></textarea>
                    </div> 
                    
                    <div class='form-group col-12'>
                        <div class="custom-control custom-checkbox custom-checkbox-info">
                            <input name='work_completed' type="checkbox" class="custom-control-input" id="work_completed">
                            <label class="custom-control-label" for="work_completed">Completed</label>
                        </div>
                    </div>
               </div> 
            </div>
            <div class="modal-footer">     
               <button type="submit" class="btn btn-success">Update Progress</button>      
               <button type="button" class="btn btn-danger" data-dismiss="modal">Cancel</button>
            </div>
         </form>
       </div>
    </div>
 </div>	

 <div id="mdl_new_expense" class="modal fade" role="dialog">
    <div class="modal-dialog modal-lg ">
       <!-- Modal content-->
       
       <div class="modal-content">          
          <div class="modal-header">
            <h5 class="modal-title">Add New Expense</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
             <i class='bx bx-x'></i>
            </button>
        </div>  

        <form id='frm_new_expense' action='#' method='post'>
            <div class="modal-body">
                <input type='hidden' name="id"/>                                    
                <div class="row mb-10">
                    <div class='col-12'>
                       <p class='text-dark font-weight-bold'>Bill Breakdown/Particulars</p>
                       <div class="table-responsive border">
                        <table id='tbl_expense_breakdown' class="table table-bordered table-hover" style="width:100%">
                            <thead>
                               <tr>
                                  <th>Particular</th>
                                  <th>Amount</th>
                               </tr>
                            </thead>
                            <tbody> </tbody>
                         </table> 
                         <button id="btn_new_expense_row" type="button" class="btn btn-light ml-1 mb-2">Add New Row</button>
    
                         <h5 id="lbl_expense_total" class="text-right p-2 bg-light mb-0">Total: Kes 0.00</h5>                      
                        </div>                        
                    </div>
                </div>                    
            </div>  
            <div class="modal-footer">  
                <button type="button" class="btn btn-danger" data-dismiss="modal">Cancel</button>  
                <button type="submit" class="btn btn-success">Save Expense</button>
            </div> 
        </form>       
       </div>
    </div>
</div>
  
  
  <script>
    window.onload=function(){window.jQuery||window.location.reload()};
   

$(document).ready(function(){
    $('input[type="checkbox"]').on("change",function(){this.value=this.checked?1:0}).change();
    
    $("#tbl_expense_breakdown").SetEditable({
        autoDelete: false,
        columnsEd: "0, 1",
        onEdit: function() {computeBill()}, 
        onDelete: function() {computeBill()},
        $addButton: $("#btn_new_expense_row"),
	});
        
    $('#frm_work_order_progress').validate();
    		
    $("#frm_new_work_order").validate({
    rules: {                   
    property_code:{
        required: true,                          
    },
    unit_code:{
        required: true                         
    },
    description:{                      
            required: true,
            maxlength: 600,
            minlength:10   
    }               
    },
    messages: {
    property_code:{
        required: "Please select the target property",                           
    },
    unit_code:{
        required: "Please select the target unit"                          
    },
    description:{                           
            required: "Please provide a description of the work order",
            maxlength: "The maximum description length is 600 characters",
            minlength: "The minimum description length is 10 characters"   
    }             
    }
});

    $("#frm_edit_work_order").validate({
rules: {                   
        property_code:{
            required: true,                          
        },
        unit_code:{
            required: true                         
        },
        description:{                      
                required: true,
                maxlength: 600,
                minlength:10   
        }               
        },
        messages: {
        property_code:{
            required: "Please select the target property",                           
        },
        unit_code:{
            required: "Please select the target unit"                          
        },
        description:{                           
                required: "Please provide a description of the work order",
                maxlength: "The maximum description length is 600 characters",
                minlength: "The minimum description length is 10 characters"   
        }             
        }
});

    $('.selectpicker-select').selectpicker(); 
 
    $("#tbl_work_orders").DataTable({
         responsive: !0,
         searchDelay: 500,
        processing: !0,
         serverSide: true,
         "order": [],
         ajax: {
             url: "<%= base_url %>/manage/work-orders",
             type: "POST",
            async: true,  credentials: 'same-origin', headers: {'CSRF-Token': csrf_token}
         },
         columns: [{
             data: 'description', 
             className: "max-w-400, text-wrap",         
             
         },{
             data: null,
             className: "max-w-300", 
             render: function(data, type, row) {
                return `</span> <a class='dynamic-link' href='<%= base_url %>/manage/units/info${row.property_code}'>${row.unit_name}
                   , ${floorToLabel(row.floor)}
                  </a>`;

               
             }
             
         },{
            data: 'date_posted'            
         }
         ,{
            data: 'work_origin'            
         },{
             data: 'work_type'
             
         },{
             data: null,            
             render: function(data, type, row) {
                if(data.priority=='High'){
                    return '<span class="badge badge-danger">High</span>';
                }else if(data.priority=='Low'){
                    return '<span class="badge badge-success">Low</span>';
                }else{
                    return '<span class="badge badge-primary">Normal</span>';
                }
             }
             
         },{
             data: 'supplier_code',    
             className: "max-w-300",      
             render: function(data, type, row) {
                if(row.supplier_code){
                    return "<a class='dynamic-link' href='<%= base_url %>/suppliers/detailed/"+row.supplier_code +"/units'>"+ row.supplier_name +"</a>";
                }else{
                    return `<span class='badge badge-warning'>Not Assigned</span>`;
                }               
            }
             
         },
         
         {
             data:'status',
                
             render:function(data, type, row) {
                 var st='<a data-toggle="collapse" role="button" aria-expanded="false" aria-controls="a'+row.id+'" href="#a'+row.id+'"';
                 var bt=""
                if(row.status=='Cancelled'){
                    bt= ' class="badge badge-danger">Cancelled</a> - click to view';
                }else if(row.status=='In Progress'){
                    bt= ' class="badge badge-primary">In Progress</a> - click to view';
                }else if(row.status=='Completed'){
                    bt= ' class="badge badge-success">Completed</a> - click to view';
                }else if(row.status=='Pending'){
                    bt= ' class="badge badge-info">Pending</a>';
                }else{
                    bt= ' class="badge badge-warning">Pending Approval</a>';
                }
                var pgs= JSON.parse(row.progress) || [];             
                var dv="";               
                if(pgs.length>0){
                    dv='<div id="a'+row.id+'" class="collapse mt-2 text-wrap alert alert-light">';
               
                    var pds = "";
                    for(var i=0; i < pgs.length; i++){
                        pds +='<b>Date/Time:</b> '+ pgs[i].activity_date +"<br><b>Activity:</b> " + pgs[i].description+"<br><hr>";
                    }
                    dv +=pds +'</div>';
                }  
                return st+bt +dv;
             }
         },
         {
             data:null,
             responsivePriority: -1,
             render:function(data, type, row) {
                 return actionData(data);
             }
         }
         ]
     });

    $("#frm_new_work_order").submit(function(e){
        e.preventDefault();
        var isvalid = $("#frm_new_work_order").valid();
        if(isvalid){
            $('#btn_save_work_order').html('Please wait...');
                      $("#btn_save_work_order").attr("disabled", true);
         var data = new myFormData($(this));
        $.ajax({
                  type: "POST",
                  async: true,  
                  credentials: 'same-origin', headers: {'CSRF-Token': csrf_token},
                  url: "<%= base_url %>/manage/work-orders/new",
                  data: data,
                  success: function(data) {                     
                    resetSaveButton();                  
                      if (data.Status == 200) {   
                        $('#frm_new_work_order').trigger("reset");
                        $("#mdl_new_work_order").modal("hide");
                        $("#tbl_work_orders").DataTable().ajax.reload();
						showAppNotification('success', data.Message);                      
                      } else {                         
                      showAppNotification('warning', data.Message);
                      }
                  },
                  error: function(err) {                      
					resetSaveButton();
                      showAppNotification( 'danger', 'Unable to complete your request. Please try again later!');
                  }
              });
          
        }
      
        
    });

    $("#frm_edit_work_order").submit(function(e){
        e.preventDefault();
        var isvalid = $("#frm_edit_work_order").valid();
        if(isvalid){
            $('#btn_edit_work_order').html('Please wait...');
                      $("#btn_edit_work_order").attr("disabled", true);
         var data = new myFormData($(this));
        $.ajax({
                  type: "POST",
                  async: true,  
                  credentials: 'same-origin', headers: {'CSRF-Token': csrf_token},
                  url: "<%= base_url %>/manage/work-orders/update",
                  data: data,
                  success: function(data) {                     
                    resetUpdateButton();                  
                      if (data.Status == 200) {   
                        $('#frm_edit_work_order').trigger("reset");
                        $("#mdl_edit_work_order").modal("hide");
                        $("#tbl_work_orders").DataTable().ajax.reload();
						showAppNotification('success', data.Message);                      
                      } else {                         
                      showAppNotification('warning', data.Message);
                      }
                  },
                  error: function(err) {                      
					resetUpdateButton();
                      showAppNotification( 'danger', 'Unable to complete your request. Please try again later!');
                  }
              });
          
        }
      
        
    });
    
    $("#frm_work_order_progress").submit(function(e){
        e.preventDefault();
        var isvalid = $("#frm_work_order_progress").valid();
        if(isvalid){
            $('#frm_work_order_progress submit').html('Please wait...');
            $("#frm_work_order_progress submit").attr("disabled", true);
         var data = new myFormData($(this));
        $.ajax({
                  type: "POST",
                  async: true,  
                  credentials: 'same-origin', headers: {'CSRF-Token': csrf_token},
                  url: "<%= base_url %>/manage/work-orders/update-progress",
                  data: data,
                  success: function(data) {                     
                    $('#frm_work_order_progress submit').html('Update Progress');
                    $("#frm_work_order_progress submit").attr("disabled", false);;                
                      if (data.Status == 200) {   
                        $('#frm_work_order_progress').trigger("reset");
                        $("#mdl_add_work_progress").modal("hide");
                        $("#tbl_work_orders").DataTable().ajax.reload();
						showAppNotification('success', data.Message);                      
                      } else {                         
                      showAppNotification('warning', data.Message);
                      }
                  },
                  error: function(err) {                      
					$('#frm_work_order_progress submit').html('Update Progress');
                    $("#frm_work_order_progress submit").attr("disabled", false);
                      showAppNotification( 'danger', 'Unable to complete your request. Please try again later!');
                  }
              });
          
        }
      
        
    });

    $("#frm_new_expense").on("submit", function(e) {     
    e.preventDefault();
        var entries = $("#tbl_expense_breakdown").tableToJSON({
		    columns: new Array(0, 1),
	    });   
        if(entries.length>0){           
            makeBusy('#mdl_new_expense .modal-dialog');
            var data = new myFormData($(this));
            data.entries=entries;
            $.ajax({
                type: "POST",
                async: true, 
                credentials: 'same-origin',
                headers: {
                    'CSRF-Token': csrf_token
                },
                url: "<%= base_url %>/manage/work-orders/generate-bill",
                data: data,
                success: function(data) {
                    makeBusy('#mdl_new_expense .modal-dialog', 0);
                    if(data.Status == 200) {
                        showAppNotification('success', data.Message); 
                        $('#mdl_new_expense').modal('hide');
                        $("#frm_new_expense").trigger('reset');
                        $("#tbl_expense_breakdown tbody").html('');
                        $("#lbl_expense_total").html('Total Kes 0.00');                        
                        $("#tbl_work_orders").DataTable().ajax.reload();
                    } else {                                             
                        showAppNotification('warning', data.Message); 
                    }
                },
                error: function(err) {
                    makeBusy('#mdl_new_expense .modal-dialog', 0);
                    showAppNotification( 'danger', 'Unable to complete your request. Please try again later!'); 
                },
            });

        }else{
            showAppNotification("warning","Please provide title, description and break down");
        }
           
	});

    loadPropUnits($('#property_code').val());

    getSuppliers();
});

function computeBill(){
    var data = $("#tbl_expense_breakdown").tableToJSON({
		        columns: new Array(0, 1),
	        });           
            var total = 0;
            for (var i = 0; i <data.length; i++){
                total +=parseFloat(data[i]["Amount"])
            }
            $("#lbl_expense_total").html("Total: " + formatMoney(total));
}

function getSuppliers(){    
	$.ajax({
		type: "POST",
        async: true,  credentials: 'same-origin', headers: {'CSRF-Token': csrf_token},
		url: "<%= base_url %>/suppliers/list",
		data: "",
		success: function(data) {			
			if(data.Status ==200) {
				var supps = data.Message;
				var y = supps.length;
				var x = 0;
				var options = [];
				while(x < y) {
					var val = '<option value="' + supps[x].supplier_code + '">' + supps[x].full_name +"</option>";
					
					options.push(val);
					x++;
				}
				$("#supplier_code").html(options.join(""));	
                $("#edit_supplier_code").html(options.join(""));	                			
				$(".selectpicker-select").selectpicker("refresh");
			}
		},
		error: function(err) {
			showAppNotification("danger", "An error has occured. Unable to list suppliers");
		},
	});
}

function actionData(data){
    var btns = `    
    <a class="dropdown-item dynamic-link" href="<%= base_url %>/manage/work-orders/${data.id}">Detailed Information</a>`;		
    if(!data.completed){
        btns+=`
        <a class="dropdown-item" href="javascript:void(0)" onclick="editWork('${data.id}')">Edit Work Order</a>
        <a class="dropdown-item text-danger" href="javascript:void(0)" onclick="deleteWork('${data.id}')">Delete Work Order</a>
        <a class="dropdown-item" href="javascript:void(0)" onclick="updateProgress('${data.id}')">Update Progress</a>`;
    }else if(!data.bill_generated){
        btns+=`<a class="dropdown-item text-success" href="javascript:void(0)" onclick="generateBill('${data.id}')">Generate Bill</a>`;
    }

    if(!data.status=='Pending Approval'){
        btns+=`<a class="dropdown-item" href="javascript:void(0)" onclick="approveWork('${data.id}')">Approve Work Order</a>`;
    }
		  
    return row_begin + btns + row_end;
}

function resetUpdateButton(){
    $('#btn_edit_work_order').html('Update Work Order');
    $("#btn_edit_work_order").attr("disabled", false);
}
          
function resetSaveButton(){
    $('#btn_save_work_order').html('Save Work Order');
    $("#btn_save_work_order").attr("disabled", false);
}

function deleteWork(id){
            sharpAlert({
        title: "Confirm?",
        text: "Are you sure you want to delete this work order?",
        type: "warning",
        showCancelButton: true,
        confirmButtonText: "Yes",
        confirmButtonClass: "btn btn-success mr-2 btn-swal",
        cancelButtonText: "No",
        cancelButtonClass: "btn btn-danger mr-2 btn-swal",
       
        
    },(passed)=>{
        if (passed) {
            $.ajax({
                type: "POST",
                async: true,
                credentials: "same-origin",
                headers: { "CSRF-Token": csrf_token },
                url: "<%= base_url %>/manage/work-orders/delete",
                data: {id: id},
                success: function (data) {
                    if (data.Status == 200) {
                        showAppNotification("success", data.Message);
                        $("#tbl_work_orders").DataTable().ajax.reload();
                    } else {
                        showAppNotification("warning", data.Message);
                    }
                },
                error: function (err) {
                    showAppNotification( 'danger', 'Unable to complete your request. Please try again later!');
                },
            });
        }
    });
          }

function approveWork(id){
sharpAlert({
title: "Confirm?",
text: "Are you sure you want to approve this work order?",
type: "warning",
showCancelButton: true,
confirmButtonText: "Yes",
confirmButtonClass: "btn btn-success mr-2 btn-swal",
cancelButtonText: "No",
cancelButtonClass: "btn btn-danger mr-2 btn-swal",


},(passed)=>{
if (passed) {
$.ajax({
    type: "POST",
    async: true,
    credentials: "same-origin",
    headers: { "CSRF-Token": csrf_token },
    url: "<%= base_url %>/manage/work-orders/approve",
    data: {id: id},
    success: function (data) {
        if (data.Status == 200) {
            showAppNotification("success", data.Message);
            $("#tbl_work_orders").DataTable().ajax.reload();
        } else {
            showAppNotification("warning", data.Message);
        }
    },
    error: function (err) {
        showAppNotification( 'danger', 'Unable to complete your request. Please try again later!');
    },
});
}
});
}

function editWork(id){
    $.ajax({
                type: "POST",
                async: true,
                credentials: "same-origin",
                headers: { "CSRF-Token": csrf_token },
                url: "<%= base_url %>/manage/work-orders/info",
                data: {id:id},
                success: function (data) {                   
                    if (data.Status == 200) {                       
                       var work = data.Message; 
                       formDeserialize('frm_edit_work_order', work);                     
                       $("#mdl_edit_work_order").modal("show");

                    } else {
                        showAppNotification("warning", data.Message);
                    }
                },
                error: function (err) {
                    showAppNotification( 'danger', 'Unable to complete your request. Please try again later!');
                },
            });
}

function generateBill(id){
    let b = {id: id};                                       
    formDeserialize('frm_new_expense', b);
    $("#mdl_new_expense").modal("show");
}

function loadPropUnits(val) {
	$.ajax({
		type: "POST",
        async: true,  credentials: 'same-origin', headers: {'CSRF-Token': csrf_token},
		url: "<%= base_url %>/manage/units/list",
		data: "",
		success: function(data) {	
            if(data.Status == 200){
                var units = data.Message;
				var y = units.length;
				var x = 0;
				var options = [];
				while(x < y) {
					var val = '<option value="' + units[x].unit_code + '">' + units[x].unit_name + " - " + floorToLabel(units[x].floor) + "</option>";
					
					options.push(val);
					x++;
				}
				$("#unit_code").html(options.join(""));	
                $("#edit_unit_code").html(options.join(""));				
				$(".selectpicker-select").selectpicker("refresh");
            }
		},
		error: function(err) {
			showAppNotification("danger", "An error has occured. Unable to list units");
		},
	});
}

function updateProgress(id){   
    $('#activity_date').val(todaysDate());
    $('#progress_work_id').val(id.toString());
    $('#mdl_add_work_progress').modal('show');
}

</script>
    
  <% if(!load_chunk){%> </body></html> <%}%>