<% if(!load_chunk){%> 
    <%- include('../shared/page-header') %>
    <%- include('../shared/top-page') %>
    <div class="page-content">
  <%}%>
			<div class="container-fluid">
				<%- include('../shared/page-title') %>
                
				<div class="d-flex flex-column-fluid">
                    <!--begin::Container-->
                    <div class="container">
                       <!--begin::Card-->                       
                       <div class="card">                                 
                          <div class="card-body">
                              <div class='row'>
                                <div class='col-lg-7'>
                                    <h4 class="card-title">Property Managers</h4>
                                    <p class="text-muted pt-2 font-size-sm">Manage all your property managers/agents/caretakers etc</p>
                                    
                                  </div>
                                  <div class='col-lg-5 text-right' style="margin:auto;">
                                    <button data-toggle="modal" data-target="#mdl_new_user" class="btn btn-info small-block px-4 mt-0 mb-3 mr-2"  >+ Add New Manager</a>
                                 </div>
                              </div>
                            <div class='col-12'>
                                <hr>
                                 <!--begin: Datatable-->
                             <table class="table border dt-responsive table-hover" id="tbl_managers" style="width:100%">
                                <thead>
                                   <tr>
                                      <th>Full Name</th>
                                      <th>Email Address</th>
                                      <th>Phone Number</th>                                    
                                      <th>Property</th> 
                                      <th>Status</th> 
                                      <th>Actions</th>                                          
                                   </tr>
                                </thead>
                             </table>
                             <!--end: Datatable-->
                            </div>
                          </div>
                       </div>
                       <!--end::Card-->
                    </div>
                    <!--end::Container-->
                 </div>
			</div>
			<!-- container-fluid -->

            <div id="mdl_new_user" class="modal fade" role="dialog">
                <div class="modal-dialog">
                   <!-- Modal content-->
                   <div class="modal-content">
                      <div class="modal-header">
                         <h5 class="modal-title">New Manager</h5>
                         <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                         <i class='bx bx-x'></i>
                         </button>
                      </div>
                      <form id="frm_new_user" method="post" action ="#">
                         <div class="modal-body">
                            <div class="row">                                                
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="first_name">First Name <span class="text-danger">*</span></label>
                                        <input type="text" class="form-control" name="first_name" id="first_name" maxlength="100" autocomplete="off"  required>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="last_name">Last Name <span class="text-danger">*</span></label>
                                        <input type="text" class="form-control" name="last_name" id="last_name" maxlength="100" autocomplete="off"  required>
                                    </div>
                                </div>
                            </div>
                            <div class="row">                                                
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="email_address">Email Address <span class="text-danger">*</span></label>
                                        <input type="email" class="form-control" name="email_address" id="email_address"placeholder="User's email address" maxlength="255"  autocomplete="off" required>                                        
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="last_name">Phone Number</label>
                                        <input type="text" class="form-control" name="phone_number" id="phone_number" placeholder="User's phone No eg 07XX" autocomplete="off" maxlength="12">
                                    </div>
                                </div>                                
                            </div>                                                    
                         </div>
                         <div class="modal-footer">     
                            <button id="btn_save_user" type="submit" class="btn btn-success">Save Manager</button>      
                            <button type="button" class="btn btn-danger" data-dismiss="modal">Cancel</button>
                         </div>
                      </form>
                   </div>
                </div>
             </div>	

             <div id="mdl_edit_user" class="modal fade" role="dialog">
                <div class="modal-dialog">
                   <!-- Modal content-->
                   <div class="modal-content">
                      <div class="modal-header">
                         <h5 class="modal-title">New Manager</h5>
                         <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                         <i class='bx bx-x'></i>
                         </button>
                      </div>
                      <form id="frm_edit_user" method="post" action ="#">
                          <input type="hidden" name="manager_id"/>
                         <div class="modal-body">
                            <div class="row">                                                
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="first_name">First Name <span class="text-danger">*</span></label>
                                        <input type="text" class="form-control" name="first_name" id="edit_first_name" maxlength="100" autocomplete="off"  required>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="last_name">Last Name <span class="text-danger">*</span></label>
                                        <input type="text" class="form-control" name="last_name" id="edit_last_name" maxlength="100" autocomplete="off"  required>
                                    </div>
                                </div>
                            </div>
                            <div class="row">                                                
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="email_address">Email Address <span class="text-danger">*</span></label>
                                        <input type="email" class="form-control" name="email_address" id="edit_email_address"placeholder="User's email address" maxlength="255"  autocomplete="off" required>                                        
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="last_name">Phone Number</label>
                                        <input type="text" class="form-control" name="phone_number" id="edit_phone_number" placeholder="User's phone No eg 07XX" autocomplete="off" maxlength="12">
                                    </div>
                                </div>                                
                            </div>                                                     
                         </div>
                         <div class="modal-footer">     
                            <button id="btn_edit_user" type="submit" class="btn btn-success">Update Manager</button>      
                            <button type="button" class="btn btn-danger" data-dismiss="modal">Cancel</button>
                         </div>
                      </form>
                   </div>
                </div>
             </div>	

            <div id="mdl_assign_property" class="modal fade" role="dialog">
                <div class="modal-dialog modal-dialog-centered ">
                   <!-- Modal content-->
                   <div class="modal-content">
                      <div class="modal-header">
                         <h5 class="modal-title">Assign Property to Manager</h5>
                         <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                         <i class='bx bx-x'></i>
                         </button>
                      </div>
                      <form id="frm_assign_property" method="post" action ="#">
                          <input type="hidden" class="manager_id" name="manager_id"/>
                         <div class="modal-body">
                            <div class="row">
                               <div class="col-12">
                                   <div class="form-group">
                                        <label for="property_code" >Property<span class="text-danger">*</span></label>
                                        <select name='property_code' id="property_code" class="form-control selectpicker" required>

                                        </select>                                        
                                   </div>
                                   <div class="form-group mb-0 mt-0">
                                    <label>Rights <span class="text-muted font-size-12">(Check to assign a right)</span></label>
                                    <div class="form-inline">                                      
                                       <div class="custom-control custom-checkbox mb-2  mr-3">
                                           <input type="checkbox" class="custom-control-input"  name='manage_units' id="manage_units" value='1'>
                                           <label class="custom-control-label" for="manage_units">Manage Units/Rooms</label>
                                       </div>
    
                                       <div class="custom-control custom-checkbox mb-2  mr-3">
                                           <input type="checkbox" class="custom-control-input" name='manage_tenants' id="manage_tenants" value='1'>
                                           <label class="custom-control-label" for="manage_tenants">Manage Tenants</label>
                                       </div>

                                       <div class="custom-control custom-checkbox mb-2  mr-3">
                                            <input type="checkbox" class="custom-control-input" name='manage_leases' id="manage_leases" value='1'>
                                            <label class="custom-control-label" for="manage_leases">Manage Leases</label>
                                        </div>
    
                                        <div class="custom-control custom-checkbox mb-2 mr-3 ">
                                           <input type="checkbox" class="custom-control-input" id="manage_expenses" name='manage_expenses' value='1' >
                                           <label class="custom-control-label" for="manage_expenses">Manage Expenses</label>
                                       </div>
    
                                       <div class="custom-control custom-checkbox mb-2  mr-3">
                                           <input type="checkbox" class="custom-control-input" id="manage_payments" name='manage_payments' value='1'>
                                           <label class="custom-control-label" for="manage_payments">Manage Payments</label>
                                       </div>
    
                                       <div class="custom-control custom-checkbox mb-2  mr-3">
                                           <input type="checkbox" class="custom-control-input" id="meter_readings" name='meter_readings' value='1' >
                                           <label class="custom-control-label" for="meter_readings">Manage Meter Readings</label>
                                       </div>

                                       <div class="custom-control custom-checkbox mb-2  mr-3">
                                           <input type="checkbox" class="custom-control-input" id="manage_images" name='manage_images' value='1' >
                                           <label class="custom-control-label" for="manage_images">Manage Property Images</label>
                                       </div>
                                    </div>                       
                                </div>
                               </div>
                            </div> 
                         </div>
                         <div class="modal-footer">     
                            <button id="btn_save_group" type="submit" class="btn btn-success">Asign Property</button>      
                            <button type="button" class="btn btn-danger" data-dismiss="modal">Cancel</button>
                         </div>
                      </form>
                   </div>
                </div>
             </div>

             <div id="mdl_edit_rights" class="modal fade" role="dialog">
                <div class="modal-dialog modal-dialog-centered ">
                   <!-- Modal content-->
                   <div class="modal-content">
                      <div class="modal-header">
                         <h5 class="modal-title">Assign Rights to Manager</h5>
                         <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                         <i class='bx bx-x'></i>
                         </button>
                      </div>
                      <form id="frm_edit_rights" method="post" action ="#">
                          <input type="hidden" name="manager_id"/>
                          <input type="hidden" name="property_code"/>
                         <div class="modal-body">
                            <div class="row">
                               <div class="col-12">
                                   <h5 class="mb-2" id="edit_rights_title">TITLE</h5>                                  
                                   <div class="form-group mb-0 mt-0">
                                    <label>Rights <span class="text-muted font-size-12">(Check to assign a right)</span></label>
                                    <div class="form-inline">                                      
                                       <div class="custom-control custom-checkbox mb-2  mr-3">
                                           <input type="checkbox" class="custom-control-input"  name='manage_units' id="edit_manage_units" value='1'>
                                           <label class="custom-control-label" for="edit_manage_units">Manage Units/Rooms</label>
                                       </div>
    
                                       <div class="custom-control custom-checkbox mb-2  mr-3">
                                           <input type="checkbox" class="custom-control-input" name='manage_tenants' id="edit_manage_tenants" value='1'>
                                           <label class="custom-control-label" for="edit_manage_tenants">Manage Tenants</label>
                                       </div>

                                       <div class="custom-control custom-checkbox mb-2  mr-3">
                                            <input type="checkbox" class="custom-control-input" name='manage_leases' id="edit_manage_leases" value='1'>
                                            <label class="custom-control-label" for="edit_manage_leases">Manage Leases</label>
                                        </div>
    
                                        <div class="custom-control custom-checkbox mb-2 mr-3 ">
                                           <input type="checkbox" class="custom-control-input" id="edit_manage_expenses" name='manage_expenses' value='1' >
                                           <label class="custom-control-label" for="edit_manage_expenses">Manage Expenses</label>
                                       </div>
    
                                       <div class="custom-control custom-checkbox mb-2  mr-3">
                                           <input type="checkbox" class="custom-control-input" id="edit_manage_payments" name='manage_payments' value='1'>
                                           <label class="custom-control-label" for="edit_manage_payments">Manage Payments</label>
                                       </div>
    
                                       <div class="custom-control custom-checkbox mb-2  mr-3">
                                           <input type="checkbox" class="custom-control-input" id="edit_meter_readings" name='meter_readings' value='1' >
                                           <label class="custom-control-label" for="edit_meter_readings">Manage Meter Readings</label>
                                       </div>

                                       <div class="custom-control custom-checkbox mb-2  mr-3">
                                           <input type="checkbox" class="custom-control-input" id="edit_manage_images" name='manage_images' value='1' >
                                           <label class="custom-control-label" for="edit_manage_images">Manage Property Images</label>
                                       </div>
                                    </div>                       
                                </div>
                               </div>
                            </div> 
                         </div>
                         <div class="modal-footer">     
                            <button id="btn_save_group" type="submit" class="btn btn-success">Update Rights</button>      
                            <button type="button" class="btn btn-danger" data-dismiss="modal">Cancel</button>
                         </div>
                      </form>
                   </div>
                </div>
             </div>

            

            <% if(!load_chunk){%> </div> <%- include('../shared/page-footer') %> <%- include('../shared/admin-scripts') %> <%}%>

<script>
    window.onload=function(){window.jQuery||window.location.reload()};
$(document).ready(function(){
    $('input[type="checkbox"]').on("change",function(){this.value=this.checked?1:0}).change();   
   
    $('.selectpicker').selectpicker();
        
    $("#frm_new_user").validate({
                  rules: {                   
                    first_name:{
                        required: true,
                          minlength:3,
                          maxlength: 100   
                    },
                    last_name:{
                        required: true,
                          minlength:3,
                          maxlength: 100   
                    },
                    email_address:{
                        remote:"<%= base_url %>/admin/managers/exists",
                          email: true,
                          required: true,
                          maxlength: 255   
                    },
                    phone_number:{                     
                        maxlength: 12,
                        minlength:8
                    }                   
                  },
                  messages: {
                    first_name:{
                        required: "Please enter the first name",
                          minlength:"First name should be between 1 and 100 characters",
                          maxlength: "First name should be between 1 and 100 characters",   
                    },
                    last_name:{
                        required: "Please enter the last name",
                          minlength:"Last name should be between 1 and 100 characters",
                          maxlength: "Last name should be between 1 and 100 characters",  
                    },
                    email_address:{
                            remote:"A manager with this email already exists",
                          email: "Please enter a correct email address",
                          required: "Please enter a correct email address",
                          maxlength: "Please enter a correct email address"   
                    },
                    phone_number:{                     
                        maxlength: "Please enter a correct phone number ie 07XXXXXXXX",
                        minlength:"Please enter a correct phone number ie 07XXXXXXXX"
                    }                               
                  }
          });

    $("#frm_edit_user").validate({
                  rules: {                   
                    first_name:{
                        required: true,
                          minlength:3,
                          maxlength: 100   
                    },
                    last_name:{
                        required: true,
                          minlength:3,
                          maxlength: 100   
                    },
                    email_address:{
                          email: true,
                          required: true,
                          maxlength: 255   
                    },
                    phone_number:{                     
                        maxlength: 12,
                        minlength:8
                    }
                  },
                  messages: {
                    first_name:{
                        required: "Please enter the first name",
                          minlength:"First name should be between 1 and 100 characters",
                          maxlength: "First name should be between 1 and 100 characters",   
                    },
                    last_name:{
                        required: "Please enter the last name",
                          minlength:"Last name should be between 1 and 100 characters",
                          maxlength: "Last name should be between 1 and 100 characters",  
                    },
                    email_address:{
                          email: "Please enter a correct email address",
                          required: "Please enter a correct email address",
                          maxlength: "Please enter a correct email address"   
                    },
                    phone_number:{                     
                        maxlength: "Please enter a correct phone number ie 07XXXXXXXX",
                        minlength:"Please enter a correct phone number ie 07XXXXXXXX"
                    }              
                  }
          });

    $("#frm_assign_property").validate({});

    var tbl_managers = $("#tbl_managers").DataTable({
        responsive: !0,       
        searchDelay: 500,
        processing: !0,
        serverSide: true,
        "order": [],
        ajax: {
            url: "<%= base_url %>/admin/managers",
            type: "POST",
            async: true,  credentials: 'same-origin', headers: {'CSRF-Token': csrf_token}
        },      
        columns: [{
             data: "full_name"
             
         } , {
             data: "email_address"
             
         } ,{
             data: "phone_number"
             
         } ,{
            data: 'properties',
             render: function(data, type, row) {                   
                if(row.properties){
                    let ps = JSON.parse(row.properties);
                    console.log(ps.length);
                    let rs='';
                    for(let i=0; i<ps.length; i++){
                      
                        rs +=`<div class="alert alert-light border alert-dismissible   mb-1 p-1" >
                                <div>
                                    <div class="d-flex justify-content-between">
                                        <div>
                                            <div class='d-inline'>
                                                <img src="<%= base_url %>/public/properties/display-picture/${ps[i].property_code}" alt="" class="rounded-circle avatar-sm">                                   
                                            </div>
                                            <span class='d-inline ml-2'>${ps[i].property_name}</span>
                                        </div>
                                        <div class="dropdown d-flex align-items-center">
                                            <button class='btn btn-light btn-sm' data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" id="property_${ps[i].property_code}"><i class='bx bx-menu'></i></button>                               
                                            <div class="dropdown-menu" aria-labelledby="property_${ps[i].property_code}">
                                                <a class="dropdown-item" onclick="editRights('${ps[i].property_code}','${row.manager_id}','${ps[i].property_name}','${row.full_name}')" href="javascript:void(0)">Edit Rights</a>
                                                <a class="dropdown-item text-danger" onclick="removeProperty('${ps[i].property_code}','${row.manager_id}')" href="javascript:void(0)">Remove</a>
                                            </div>
                                        </div>   
                                    </div>    
                                </div>    
                                                        
                            </div>`;
                    }                    
                    return rs;
                }else{
                    return "<span class='p-2 m-1 badge badge-danger'>No assigned property</span>";
                }       
             }
         },{
            data: 'account_active',
             render: function(data, type, row) {
                if(row.account_active){
                    return "<span class='badge badge-success'>Active</span>";
                }else{
                    return "<span class='badge badge-danger'>Not Active</span>";
                }               
             }
         },
         {
            data:null,
            responsivePriority: -1,
            render:function(data, type, row) {
                return actionData(row);
            }
        }
        ]
     });

   
});


$("#frm_new_user").submit(function(e){
        e.preventDefault();
        var isvalid = $("#frm_new_user").valid();
        if(isvalid){
            $('#btn_save_user').html('Please wait...');
                      $("#btn_save_user").attr("disabled", true);
         var data = new myFormData($(this));
        $.ajax({
                  type: "POST",
                  async: true,  
                  credentials: 'same-origin', headers: {'CSRF-Token': csrf_token},
                  url: "<%= base_url %>/admin/managers/new",
                  data: data,
                  success: function(data) {                     
                    resetSaveButton();                  
                      if (data.Status == 200) {   
                        $('#frm_new_user').trigger("reset");
                        $("#mdl_new_user").modal("hide");
                        $("#tbl_managers").DataTable().ajax.reload();
						showAppNotification('success', data.Message);                      
                      } else {                         
                      showAppNotification('warning', data.Message);
                      }
                  },
                  error: function(err) {                      
					resetSaveButton();
                      showAppNotification( 'danger', 'Unable to complete your request. Please try again later!');
                  }
              });
          
        }
      
        
    });

$("#frm_edit_user").submit(function(e){
        e.preventDefault();
        var isvalid = $("#frm_edit_user").valid();
        if(isvalid){
            $('#btn_edit_user').html('Please wait...');
                      $("#btn_edit_user").attr("disabled", true);
         var data = new myFormData($(this));
        $.ajax({
                  type: "POST",
                  async: true,  
                  credentials: 'same-origin', headers: {'CSRF-Token': csrf_token},
                  url: "<%= base_url %>/admin/managers/update",
                  data: data,
                  success: function(data) {                     
                    resetUpdateButton();                  
                      if (data.Status == 200) {   
                        $('#frm_edit_user').trigger("reset");
                        $("#mdl_edit_user").modal("hide");
                        $("#tbl_managers").DataTable().ajax.reload();
						showAppNotification('success', data.Message);                      
                      } else {                         
                      showAppNotification('warning', data.Message);
                      }
                  },
                  error: function(err) {                      
					resetUpdateButton();
                      showAppNotification( 'danger', 'Unable to complete your request. Please try again later!');
                  }
              });
          
        }     
        
    });
  
$("#frm_assign_property").submit(function(e){
    e.preventDefault();
    var isvalid = $("#frm_assign_property").valid();
    if(isvalid){
        makeBusy('#mdl_assign_property .modal-dialog');
        var data = new myFormData($(this));
        $.ajax({
            type: "POST",
            async: true,  
            credentials: 'same-origin', headers: {'CSRF-Token': csrf_token},
            url: "<%= base_url %>/admin/managers/assign-property",
            data: data,
            success: function(data) {                     
                makeBusy('#mdl_assign_property .modal-dialog', 0);                
                if (data.Status == 200) {   
                    $('#frm_assign_property').trigger("reset");
                    $("#mdl_assign_property").modal("hide");
                    $("#tbl_managers").DataTable().ajax.reload();
                    showAppNotification('success', data.Message);                      
                } else {                         
                    showAppNotification('warning', data.Message);
                }
            },
            error: function(err) {                      
                makeBusy('#mdl_assign_property .modal-dialog', 0);    
                showAppNotification( 'danger', 'Unable to complete your request. Please try again later!');
            }
        });            
    }   
    
});

$("#frm_edit_rights").submit(function(e){
    e.preventDefault();
    var isvalid = $("#frm_edit_rights").valid();
    if(isvalid){
        makeBusy('#mdl_edit_rights .modal-dialog');
        var data = new myFormData($(this));
        $.ajax({
            type: "POST",
            async: true,  
            credentials: 'same-origin', headers: {'CSRF-Token': csrf_token},
            url: "<%= base_url %>/admin/managers/update-rights",
            data: data,
            success: function(data) {                     
                makeBusy('#mdl_edit_rights .modal-dialog', 0);                
                if (data.Status == 200) {   
                    $('#frm_edit_rights').trigger("reset");
                    $("#mdl_edit_rights").modal("hide");
                    $("#tbl_managers").DataTable().ajax.reload();
                    showAppNotification('success', data.Message);                      
                } else {                         
                    showAppNotification('warning', data.Message);
                }
            },
            error: function(err) {                      
                makeBusy('#mdl_edit_rights .modal-dialog', 0);    
                showAppNotification( 'danger', 'Unable to complete your request. Please try again later!');
            }
        });            
    }   
    
});

function groupsData(data){  
    var group_string="<div class='container-fluid'>";
    if(data.manage_tenants){
        group_string += `<span class="badge badge-pill small-block badge-info mt-2 ml-2 font-size-12">Manage Tenants</span>`;
    }
    if(data.manage_units){
        group_string += `<span class="badge badge-pill small-block badge-info mt-2 ml-2 font-size-12">Manage Units/Rooms</span>`;
    }
    if(data.manage_payments){
        group_string += `<span class="badge badge-pill small-block badge-info mt-2 ml-2 font-size-12">Manage Payments</span>`;
    }
    if(data.meter_readings){
        group_string += `<span class="badge badge-pill small-block badge-info mt-2 ml-2 font-size-12">Meter Readings</span>`;
    }
    if(data.manage_expenses){
        group_string += `<span class="badge badge-pill small-block badge-info mt-2 ml-2 font-size-12">Manage Expenses</span>`;
    }
    if(data.manage_images){
        group_string += `<span class="badge badge-pill small-block badge-info mt-2 ml-2 font-size-12">Manage Images/Pictures</span>`;
    }
    
    return group_string +"</div>";
}

function actionData(data){
    var btns = "";
    if(data.account_active){
        btns = `<a class="dropdown-item text-primary" href="javascript:void(0)" onclick="assignProperty('${data.manager_id}')">Assign Property</a><a class="dropdown-item text-warning" href="javascript:void(0)" onclick="changeStatus(0,'${data.manager_id}')">Deactivate Manager</a>`;
    }else{
        btns = `<a class="dropdown-item" href="javascript:void(0)" onclick="changeStatus(1,'${data.manager_id}')">Activate Manager</a>`;
    }
     btns += '<a class="dropdown-item" href="javascript:void(0)" onclick="editUser(\''+ data.manager_id +'\')">Edit Manager</a><a class="dropdown-item text-danger" href="javascript:void(0)" onclick="deleteUser(\''+ data.manager_id +'\')">Delete Manager</a><a class="dropdown-item dynamic-link" href="<%= base_url %>/admin/managers/detailed/'+ data.manager_id +'">Detailed Information</a>';		
		  
			return row_begin + btns + row_end;
}

function removeProperty(code, id){
    sharpAlert({
        title: "Confirm?",
        text: 'Are you sure you want to remove this property from this user?',
        type: "warning",
        showCancelButton: true,
        confirmButtonText: "Yes",
        confirmButtonClass: "btn btn-success mr-2 btn-swal",
        cancelButtonText: "No",
        cancelButtonClass: "btn btn-danger mr-2 btn-swal",      
        
    },(passed)=>{
        if (passed) {
            $.ajax({
                type: "POST",
                async: true,
                credentials: "same-origin",
                headers: { "CSRF-Token": csrf_token },
                url: "<%= base_url %>/admin/managers/remove-property",
                data: {manager_id:id,property_code:code},
                success: function (data) {
                    if (data.Status == 200) {
                        showAppNotification("success", data.Message);
                        $("#tbl_managers").DataTable().ajax.reload();
                    } else {
                        showAppNotification("warning", data.Message);
                    }
                },
                error: function (err) {
                    showAppNotification( 'danger', 'Unable to complete your request. Please try again later!');
                },
            });
        }
    });

}

function changeStatus(state, id){
    var message="Are you sure you want to deactivate this account?";
    if(state){
        message="Are you sure you want to activate this account?";
    }
    sharpAlert({
        title: "Confirm?",
        text: message,
        type: "warning",
        showCancelButton: true,
        confirmButtonText: "Yes",
        confirmButtonClass: "btn btn-success mr-2 btn-swal",
        cancelButtonText: "No",
        cancelButtonClass: "btn btn-danger mr-2 btn-swal",
       
        
    },(passed)=>{
        if (passed) {
            $.ajax({
                type: "POST",
                async: true,
                credentials: "same-origin",
                headers: { "CSRF-Token": csrf_token },
                url: "<%= base_url %>/admin/managers/change-status",
                data: {id:id,state:state},
                success: function (data) {
                    if (data.Status == 200) {
                        showAppNotification("success", data.Message);
                        $("#tbl_managers").DataTable().ajax.reload();
                    } else {
                        showAppNotification("warning", data.Message);
                    }
                },
                error: function (err) {
                    showAppNotification( 'danger', 'Unable to complete your request. Please try again later!');
                },
            });
        }
    });

}

function resetUpdateButton(){
			        $('#btn_edit_user').html('Update Manager');
                      $("#btn_edit_user").attr("disabled", false);
		  }
          
function resetSaveButton(){
			        $('#btn_save_user').html('Save Manager');
                      $("#btn_save_user").attr("disabled", false);
		  }

function deleteUser(id){
            sharpAlert({
        title: "Confirm?",
        text: "Are you sure you want to delete this manager?",
        type: "warning",
        showCancelButton: true,
        confirmButtonText: "Yes",
        confirmButtonClass: "btn btn-success mr-2 btn-swal",
        cancelButtonText: "No",
        cancelButtonClass: "btn btn-danger mr-2 btn-swal",
       
        
    },(passed)=>{
        if (passed) {
            $.ajax({
                type: "POST",
                async: true,
                credentials: "same-origin",
                headers: { "CSRF-Token": csrf_token },
                url: "<%= base_url %>/admin/managers/delete",
                data: "id=" + id,
                success: function (data) {
                    if (data.Status == 200) {
                        showAppNotification("success", data.Message);
                        $("#tbl_managers").DataTable().ajax.reload();
                    } else {
                        showAppNotification("warning", data.Message);
                    }
                },
                error: function (err) {
                    showAppNotification( 'danger', 'Unable to complete your request. Please try again later!');
                },
            });
        }
    });
          }

function editUser(id){
    $.ajax({
                type: "POST",
                async: true,
                credentials: "same-origin",
                headers: { "CSRF-Token": csrf_token },
                url: "<%= base_url %>/admin/managers/detailed",
                data: "id=" + id,
                success: function (data) {
                    if (data.Status == 200) {
                       var grp = data.Message;                               
                       formDeserialize('frm_edit_user', grp);
                       $("#mdl_edit_user").modal("show");

                    } else {
                        showAppNotification("warning", data.Message);
                    }
                },
                error: function (err) {
                    showAppNotification( 'danger', 'Unable to complete your request. Please try again later!');
                },
            });
}
   
function assignProperty(id){
    $.ajax({
        type: "POST",
        async: true,
        credentials: "same-origin",
        headers: { "CSRF-Token": csrf_token },
        url: "<%= base_url %>/admin/managers/get-properties",
        data: {id:id},
        success: function (data) {
            if (data.Status == 200) {
                var properties = data.Message;               
                var options = [];                
                for (var i = 0; i < properties.length; i++) {
                    options.push('<option value="',
                    properties[i].property_code, '">',
                    properties[i].property_name, '</option>');
                }
                $("#property_code").html(options.join('')); 
                $(".selectpicker").selectpicker("refresh");
                $(".manager_id").val(id);
                
               $('#mdl_assign_property').modal('show');
            } else {
                showAppNotification("warning", data.Message);
            }
        },
        error: function (err) {
            showAppNotification( 'danger', 'Unable to complete your request. Please try again later!');
        },
    });
}

function editRights(code, id, property_name, manager_name){
    $.ajax({
        type: "POST",
        async: true,
        credentials: "same-origin",
        headers: { "CSRF-Token": csrf_token },
        url: "<%= base_url %>/admin/managers/get-rights",
        data: {manager_id:id, property_code:code},
        success: function (data) {
            if (data.Status == 200) {
                var grp = data.Message;                               
                formDeserialize('frm_edit_rights', grp);
                $('#edit_rights_title').html(`Usage rights on ${property_name} for ${manager_name}`)
                $("#mdl_edit_rights").modal("show");

            } else {
                showAppNotification("warning", data.Message);
            }
        },
        error: function (err) {
            showAppNotification( 'danger', 'Unable to complete your request. Please try again later!');
        },
    });
}

</script>
  
<% if(!load_chunk){%> </body></html> <%}%>